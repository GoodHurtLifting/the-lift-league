workflows:
  liftleague_ios_build:
    name: Lift League iOS Build
    environment:
      flutter: stable
      xcode: latest

    scripts:
      - name: Install dependencies
        script: flutter pub get

      - name: Parse version and build number
        script: |
          VERSION_LINE=$(grep '^version: ' pubspec.yaml | awk '{print $2}')
          BUILD_NAME=$(echo $VERSION_LINE | cut -d "+" -f 1)
          BUILD_NUMBER=$(echo $VERSION_LINE | cut -d "+" -f 2)
          echo "BUILD_NAME=$BUILD_NAME" >> $CM_ENV
          echo "BUILD_NUMBER=$BUILD_NUMBER" >> $CM_ENV

      - name: Build iOS (unsigned)
        script: |
          flutter build ios \
            --release \
            --no-codesign \
            --build-name=$BUILD_NAME \
            --build-number=$BUILD_NUMBER
